<!DOCTYPE html><html lang="en" ng-app="npmsafeApp"><head><title>缘起 - zh</title><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="npmsafe is a security tool to help npm more safety"/><meta name="keywords" content="npm safe"/><meta name="robots" content="all"/><meta name="referrer" content="origin"/><meta name="viewport" id="viewport" content="width=device-width, initial-scale=1"/><meta property="og:title" content="Angular"/><meta property="og:image" content="/resources/images/logos/standard/shield-large.png"/><meta property="og:image:type" content="image/png"/><meta property="og:image:width" content="184"/><meta property="og:image:height" content="200"/><meta property="og:description" content="npmsafe is a security tool to help npm more safety"/><meta itemprop="name" content="Npmsafe"/><meta itemprop="description" content="npmsafe is a security tool to help npm more safety"/><meta itemprop="image" content="/resources/images/logos/standard/shield-large.png"/><link rel="icon" type="image/x-icon" href="/resources/images/icons/favicon.ico"/><link rel="stylesheet" href="/resources/libs/angular_material/0.7.1/angular-material.min.css"/><!--link(href='https://fonts.useso.com/css?family=Roboto:400,300,500,400italic,700' rel='stylesheet' type='text/css')--><link rel="stylesheet" href="/resources/css/vendor/icomoon/style.css"/><link rel="stylesheet" href="/resources/css/main.css"/><!-- MOBILE ICONS -->
<link rel="apple-touch-icon" sizes="57x57" href="/resources/images/favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/resources/images/favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/resources/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/resources/images/favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/resources/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/resources/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/resources/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/resources/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/resources/images/favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/resources/images/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/resources/images/favicons/favicon-194x194.png" sizes="194x194">
<link rel="icon" type="image/png" href="/resources/images/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/resources/images/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/resources/images/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/resources/images/favicons/manifest.json"></head><body ng-controller="AppCtrl" class="l-offset-nav l-offset-side-nav"><md-toolbar class="main-nav background-regal l-pinned-top l-layer-5"><nav><h1><a href="/" md-button>Npmsafe <sup>by Ueqt</sup></a></h1><button aria-label="View Menu" ng-click="toggleMainMenu($event)" md-button="md-button" class="main-nav-button main-nav-mobile-trigger l-right">Site Menu <span class="icon icon-arrow-drop-down"></span></button><ul ng-class="showMainNav ? 'is-visible' : ''"><li class="l-left"><a class="main-nav-button" href="/features.html" md-button>Features</a></li><li class="l-left"><a class="main-nav-button" href="/docs/en/latest/" md-button>Docs</a></li><li class="l-left"><a class="main-nav-button" href="/about/" md-button>About</a></li><li class="l-left"><a class="main-nav-button" href="/contribute.html" md-button>Contribute</a></li><!--li.l-right <a class="main-nav-button has-icon" href="/download/" md-button> <span class="icon icon-cloud-download"></span> Download</a>--></ul></nav></md-toolbar><nav class="side-nav l-pinned-left l-layer-4 l-offset-nav"><header class="side-nav-search st-input-wrapper"><form class="st-input-inner"><label for="search-io" class="is-hidden">Search Docs</label><input type="search" id="search-io" placeholder="SEARCH DOCS..."/></form><button aria-label="View Docs Menu" ng-click="toggleDocsMenu($event)" md-button="md-button" class="mobile-trigger button">Docs <span class="icon icon-arrow-drop-down"></span></button></header><ul ng-class="showDocsNav ? 'is-visible' : ''" class="side-nav-primary"><li><a class="" href="/docs/zh/latest/index.html" md-button><span class="side-nav-icon icon-home"></span> Docs Home</a></li><li><a class="is-selected" href="/docs/zh/latest/origin.html" md-button><span class="side-nav-icon icon-query-builder"></span> 缘起</a></li><li><a class="" href="/docs/zh/latest/quickstart.html" md-button><span class="side-nav-icon icon-query-builder"></span> 5分钟快速入门</a></li><li><a class="" href="/docs/zh/latest/resources.html" md-button><span class="side-nav-icon icon-play-circle-fill"></span> Npmsafe 资源</a></li><li><a class="" href="/docs/zh/latest/api.html" md-button><span class="side-nav-icon icon-book"></span> API 概要</a></li><li><a class="" href="/docs/zh/latest/help.html" md-button><span class="side-nav-icon icon-chat"></span> 帮助和支持</a></li></ul></nav><header class="hero background-sky"><h1 class="hero-title text-display-1">缘起</h1><!-- Replace _ undscores with . dots --><!-- Replace _ undscores with . dots --><!-- VERSION TREE CREATOR MIXIN --><!-- BUTTON TITLE GENERATION  --><!-- DROPDOWN BUTTON --><nav class="hero-subtitle text-subhead dropdown"><button aria-label="Select a language" md-button="md-button" ng-click="toggleVersionMenu($event)" class="dropdown-button">简体中文  <span class="icon icon-arrow-drop-down"></span></button><div ng-click="toggleVersionMenu($event)" ng-show="showMenu" class="overlay ng-hide"></div><!-- DROPDOWN MENU --><div ng-class="showMenu ? 'is-visible' : ''" class="dropdown-menu"><ul><li><a href="/docs/zh/latest/origin.html" md-button>简体中文 </a></li></ul><ul><li><a href="/docs/en/latest/origin.html" md-button>English </a></li></ul></div></nav><div class="social-icons"><!--button(aria-label="Share on G+" onClick="window.open('https://plus.google.com/share?url=#{siteURL}', '', 'height=500, width=600')" class="googleplus") <span class="icon-google-plus2"></span>--><button aria-label="Share on Twitter" onClick="window.open('https://twitter.com/share?text=Npmsafe%20-%20npmsafe is a security tool to help npm more safety', '', 'height=250, width=600')"><span class="icon-twitter2"></span></button><button aria-label="Share on Facebook" onClick="window.open('https://www.facebook.com/sharer/sharer.php?u=http://www.npmsafe.com', '', 'height=500, width=600')" data-href="http://www.npmsafe.com" data-colorscheme="dark" data-layout="button_count" data-action="like" data-show-faces="false"><span class="icon-facebook2"></span></button><!--button(aria-label="Share on Linkedin" onClick="window.open('http://www.linkedin.com/shareArticle?mini=true&url=#{siteURL}&title=Npmsafe&summary=#{description}.', '', 'height=625, width=500')") <span class="icon-linkedin"></span>--></div><p style="color: black;"></p></header><article class="l-content-small grid-fluid docs-content"><h2>转自</h2><p><a href="http://www.cnblogs.com/index-html/p/npm_package_phishing.html" target="_blank">Nodejs应用仓库钓鱼</a></p>
<h2>前言</h2><p>城堡总是从内部攻破的。再强大的系统，也得通过人来控制。如果将入侵直接从人这个环节发起，那么再坚固的防线，也都成为摆设。</p>
<p>下面分享一个例子，利用应用仓库，渗透到开发人员的系统中。</p>
<h2>应用仓库</h2><p>应用仓库对于开发人员再熟悉不过了。apt-get，brew，yum，npm ... 无非就是个命令行版的 App Store，方便各种工具以及依赖库的安装。</p>
<p>他们大致原理都差不多。今天讲解的是 NodeJS 应用仓库 —— <a href="https://www.npmjs.com/">NPM</a> 的安全试探。</p>
<h2>NPM 平台</h2><p>如果 NodeJS 只能单机运行，那就和 WScript 差不多了。好在 NPM 平台的出现，让整个社区互动起来。</p>
<p>开发者可以通过 NPM 安装需要的库，用户也可以通过它完成项目的安装。以至于短短几年时间里，数以万计的 NodeJS 项目被发布到 NPM 上，每天都有几千万次的下载量。如此大的用户群体，是否会存在安全隐患？</p>
<h2>仓库篡改</h2><p>最容易想到的，就是 NPM 账号被盗。一旦密码被泄露，攻击者就可以发布项目的新版本。正常用户一旦更新，就安装上了恶意脚本程序。</p>
<p>不过，要获取平台账号谈何容易。而且活跃度高的项目被篡改，很快就会被发现。</p>
<h2>仓库钓鱼</h2><p>改人家的东西肯定不靠谱，那就只能用自己的。但自己凭空创建的项目是毫无人气的，因此得设法引诱部分用户过来。</p>
<p>攻击者可以取一个和活跃项目差不多的名字。例如人气很高的 uglify-js，可以山寨一个叫 uglifyjs 的李鬼。一旦用户拼错了单词，就安装上了冒牌的项目。</p>
<p>为了不让用户发现，可以直接克隆原版项目，让用户能和正常版本完全一样的使用，很难发现其中的破绽。然后在某些隐蔽的模块里做些手脚，一旦用户运行了脚本，其中的恶魔就释放出来了！</p>
<p>相比传统的恶意程序，NodeJS 这种兴起不久、并且高度灵活的语言，防御程序会少的多。</p>
<h2>安装时入侵</h2><p>如果用户发现装错了项目，还没运行就卸载了，是否就无法入侵了？</p>
<p>事实上，NPM 提供了无比强大的功能，甚至可以在安装时就能<a href="https://docs.npmjs.com/misc/scripts">执行额外的命令</a>。</p>
<p><img src="http://images.cnitblog.com/blog2015/273626/201503/121718133081850.png" alt=""></p>
<p>在 <code>scripts</code> 字段里，可以定义各个阶段的命令扩展。</p>
<p>例如 <code>postinstall</code>，即可在仓库包安装完成后执行。</p>
<p><img src="http://images.cnitblog.com/blog2015/273626/201503/121718247309572.png" alt=""></p>
<p>这样，只要用户敲入 npm install xxx 时手一抖，系统就可能被入侵了。</p>
<p>这听起来似乎有些天方夜谭。不过经测试，一个活跃项目的山寨版，每天也有几十到上百的安装量（误装量~）。虽然数量很少，还不到原版的一个零头，但都是潜在的高质量用户。</p>
<p>其中大多都是开发人员，一旦系统被控制，即可渗透到企业内网里。</p>
<h2>持续性入侵</h2><p>一旦开发人员的系统被控制，产生的后果远比想象中的严重。除了各种信息被泄露外，还会有更恐怖的事。</p>
<p>以 uglify-js 为例，如果开发人员安装了钓鱼版本，那么会出现什么后果？</p>
<p>由于它本身就是一个类似编译器的压缩工具，把测试完毕的源代码，转成不可读的黑盒程序 —— 这很有可能就是上线前的最后一步。如果这个环节被黑客操控，那么即使已通过审核的源码，也难逃魔掌了。</p>
<p>也许，钓鱼工具会在压缩后的脚本里插入一段隐蔽的 XSS，开发者不仔细查看很难发现。一旦脚本被发布，线上成千上万的用户就遭殃了。</p>
<p><img src="http://images.cnitblog.com/blog2015/273626/201503/121718368555910.png" alt=""></p>
<p>攻击者不费一兵一卒，直接从最源头攻下这个堡垒。</p>
<p>当然，不仅仅可以感染 Web，其他客户端的更有可能。一些很少关注的开源库，或者头文件代码，都可能是恶意代码的藏身之处。</p>
<h2>钓鱼推广</h2><p>毕竟手误的用户是有限的。为了能扩大感染量，不排除攻击者会主动推广自己的钓鱼项目。</p>
<p>当然，这种推广不会太明显，旁人甚至根本完全感觉不到其中正真的意图。</p>
<p>攻击者可以转载一些近期热门的文章，然后将其中的演示地址替换成自己的钓鱼项目。于是，前来围观的看客们就在毫无防备的情况下一试用，被悄悄控制了。</p>
<p>或者更加直接的，在论坛或社交圈里推广自己的项目，并配上一些亮瞎的文字和炫酷的图片。于是一些好奇心强的人们，正好中了攻击者的下怀。</p>
<h2>总结</h2><p>除了 NPM 外，其他一些无需审核的应用仓库，都有可能出现钓鱼项目的风险。</p>
<p>因此平时安装时，得格外小心。忘记了名字的项目，必须查证后再安装。</p>
<p>同时对于一些来路不明的项目，也谨慎尝试。毕竟，安装一个项目和直接打开一个应用程序其实是一样的！</p></article><div class="main-footer"><nav class="background-silver grid-fluid"><div class="c3 main-footer-branding"><div class="logo-inverse-large"></div></div><div class="c2"><h3 class="text-headline">LIBRARIES</h3><ul class="text-body"><li><a href="/"> Npmsafe</a></li></ul></div><div class="c2"><h3 class="text-headline">LEARN</h3><ul class="text-body"><li><a href="/docs/en/latest/quickstart.html"> 5 Min Quickstart</a></li><li><a href="/docs/en/latest/resources.html"> Resources</a></li><li><a href="/docs/en/latest/api.html"> Full API</a></li><!--li <a href="http://goo.gl/sj0Nk1">Design Docs &amp; Notes</a>--></ul></div><div class="c2"><h3 class="text-headline">HELP</h3><ul class="text-body"><li><a href="https://groups.google.com/d/forum/npmsafe"> Google Group</a></li><li><a href="https://gitter.im/ueqt/npmsafe?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge"> Chat Room</a></li><li><a href="https://github.com/ueqt/npmsafe/issues"> Report an Issue</a></li></ul></div><div class="c3"><h3 class="text-headline">COMMUNITY</h3><ul class="text-body"><li><a href="https://twitter.com/ueqtxu_ueqt"> Twitter</a></li><li><a href="https://github.com/ueqt/npmsafe"> GitHub</a></li></ul></div></nav><footer class="background-steel"><small class="text-caption">Powered by Ueqt ©2015. Code licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0" class="text-snow">Apache License, Version 2.0</a>. Documentation licensed under <a class="text-snow" href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.</small></footer></div><!-- Angular Material Dependencies --><script src="/resources/libs/angularjs/1.3.6/angular.js"></script><script src="/resources/libs/angularjs/1.3.6/angular-animate.js"></script><script src="/resources/libs/angularjs/1.3.6/angular-aria.js"></script><script src="/resources/libs/angular_material/0.8.2/angular-material.min.js"></script><!-- VENDORS --><script src="/resources/js/vendor/prettify.js"></script><script src="/resources/js/vendor/lang-basic.js"></script><script src="/resources/js/vendor/lang-dart.js"></script><script src="/resources/js/site.js"></script></body></html>